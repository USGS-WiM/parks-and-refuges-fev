var layerCount=0;function displaySensorGeoJSON(type,name,url,markerIcon){layerCount++;var currentSubGroup=eval(type);currentSubGroup.clearLayers();var currentMarker=L.geoJson(!1,{pointToLayer:function(e,t){return markerCoords.push(t),L.marker(t,{icon:markerIcon})},onEachFeature:function(e,t){if(oms.addMarker(t),"rdg"!=type){var a=fev.vars.currentEventName,r='<table class="table table-hover table-striped table-condensed wim-table"><caption class="popup-title">'+name+' | <span style="color:gray"> '+a+'</span></caption><tr><td><strong>STN Site Number: </strong></td><td><span id="siteName">'+e.properties.site_no+'</span></td></tr><tr><td><strong>Status: </strong></td><td><span id="status">'+e.properties.status+'</span></td></tr><tr><td><strong>City: </strong></td><td><span id="city">'+(""==e.properties.city||null==e.properties.city||null==e.properties.city?"<i>No city recorded</i>":e.properties.city)+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="county">'+e.properties.county+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="state">'+e.properties.state+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.properties.latitude_dd.toFixed(4)+", "+e.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>STN data page: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+sensorPageURLRoot+e.properties.site_id+"&Sensor="+e.properties.instrument_id+">Sensor data page</a></b></span></td></tr></table>";t.bindPopup(r)}}});$.getJSON(url,(function(e){if(0!=e.length){if(e.features.length>0){console.log(e.features.length+" "+markerIcon.options.className+" GeoJSON features found");for(var t=e.features.length-1;t>=0;t--)(isNaN(e.features[t].geometry.coordinates[0])||isNaN(e.features[t].geometry.coordinates[1]))&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1)),(fev.vars.extentSouth<=e.features[t].geometry.coordinates[0]<=fev.vars.extentNorth&&fev.vars.extentWest<=e.features[t].geometry.coordinates[1]<=fev.vars.extentEast||0==e.features[t].geometry.coordinates[0]||0==e.features[t].geometry.coordinates[1])&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1));currentMarker.addData(e),currentMarker.eachLayer((function(e){e.addTo(currentSubGroup)})),currentSubGroup.addTo(map),"rdg"==currentSubGroup&&alert("RDG feature created"),checkLayerCount(layerCount)}}else console.log("0 "+markerIcon.options.className+" GeoJSON features found")}))}function displayHWMGeoJSON(e,t,a,r){layerCount++,hwm.clearLayers();var s=L.geoJson(!1,{pointToLayer:function(e,t){return markerCoords.push(t),L.marker(t,{icon:r})},onEachFeature:function(e,a){if(null!=e.properties.longitude_dd&&null!=e.properties.latitude_dd){null!=a.feature.geometry.coordinates[0]&&null!=a.feature.geometry.coordinates[1]||console.log("null coordinates returned for "+e.properties.site_no),oms.addMarker(a);var r=fev.vars.currentEventName,s='<table class="table table-hover table-striped table-condensed wim-table"><caption class="popup-title">'+t+' | <span style="color:gray">'+r+'</span></caption><col style="width:50%"> <col style="width:50%"><tr><td><strong>STN Site No.: </strong></td><td><span id="hwmSiteNo">'+e.properties.site_no+'</span></td></tr><tr><td><strong>HWM Label: </strong></td><td><span id="hwmLabel">'+e.properties.hwm_label+'</span></td></tr><tr><td><strong>Elevation(ft): </strong></td><td><span id="hwmElev">'+e.properties.elev_ft+'</span></td></tr><tr><td><strong>Datum: </strong></td><td><span id="hwmWaterbody">'+e.properties.verticalDatumName+'</span></td></tr><tr><td><strong>Height Above Ground: </strong></td><td><span id="hwmHtAboveGnd">'+(void 0!==e.properties.height_above_gnd?e.properties.height_above_gnd:"<i>No value recorded</i>")+'</span></td></tr><tr><td><strong>Approval status: </strong></td><td><span id="hwmStatus">'+(null==e.properties.approval_id||0==e.properties.approval_id?'<button type="button" class="btn btn-sm data-disclaim" title="Click to view provisional data statement">Provisional <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></button>':"Approved")+'</span></td></tr><tr><td><strong>Type: </strong></td><td><span id="hwmType"></span>'+e.properties.hwmTypeName+'</td></tr><tr><td><strong>Marker: </strong></td><td><span id="hwmMarker">'+e.properties.markerName+'</span></td></tr><tr><td><strong>Quality: </strong></td><td><span id="hwmQuality">'+e.properties.hwmQualityName+'</span></td></tr><tr><td><strong>Waterbody: </strong></td><td><span id="hwmWaterbody">'+e.properties.waterbody+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="hwmCounty">'+e.properties.countyName+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="hwmState">'+e.properties.stateName+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.properties.latitude_dd.toFixed(4)+", "+e.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>Description: </strong></td><td><span id="hwmDescription">'+e.properties.hwm_locationdescription+'</span></td></tr><tr><td><strong>Full data link: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+hwmPageURLRoot+e.properties.site_id+"&HWM="+e.properties.hwm_id+">HWM data page</a></b></span></td></tr></table>";a.bindPopup(s)}else console.log("Lat/lng undefined for HWM at site no: "+e.properties.site_no)}});$.getJSON(a,(function(e){if(0!=e.length){if(e.features.length>0){console.log(e.features.length+" "+r.options.className+" GeoJSON features found");for(var t=e.features.length-1;t>=0;t--)(isNaN(e.features[t].geometry.coordinates[0])||isNaN(e.features[t].geometry.coordinates[1]))&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1)),(fev.vars.extentSouth<=e.features[t].geometry.coordinates[0]<=fev.vars.extentNorth&&fev.vars.extentWest<=e.features[t].geometry.coordinates[1]<=fev.vars.extentEast||0==e.features[t].geometry.coordinates[0]||0==e.features[t].geometry.coordinates[1])&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1));s.addData(e),s.eachLayer((function(e){e.addTo(hwm)})),hwm.addTo(map),checkLayerCount(layerCount)}}else console.log("0 "+r.options.className+" GeoJSON features found")}))}function displayPeaksGeoJSON(e,t,a,r){layerCount++,peak.clearLayers();var s=L.geoJson(!1,{pointToLayer:function(e,t){return markerCoords.push(t),L.marker(t,{icon:r}).bindLabel("Peak: "+e.properties.peak_stage.toString())},onEachFeature:function(e,a){oms.addMarker(a);var r=fev.vars.currentEventName,s='<table class="table table-condensed table-striped table-hover wim-table"><caption class="popup-title">'+t+' | <span style="color:gray"> '+r+"</span></caption><tr><th>Peak Stage (ft)</th><th>Datum</th><th>Peak Date & Time (UTC)</th></tr><tr><td>"+e.properties.peak_stage+"</td><td>"+e.properties.vdatum+"</td><td>"+moment(e.properties.peak_date).format("dddd, MMMM Do YYYY, h:mm:ss a")+"</td></tr></table>";a.bindPopup(s)}});$.getJSON(a,(function(e){if(0!=e.length){if(e.features.length>0){console.log(e.features.length+" "+r.options.className+" GeoJSON features found");for(var t=e.features.length-1;t>=0;t--)(isNaN(e.features[t].geometry.coordinates[0])||isNaN(e.features[t].geometry.coordinates[1]))&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1)),(fev.vars.extentSouth<=e.features[t].geometry.coordinates[0]<=fev.vars.extentNorth&&fev.vars.extentWest<=e.features[t].geometry.coordinates[1]<=fev.vars.extentEast||0==e.features[t].geometry.coordinates[0]||0==e.features[t].geometry.coordinates[1])&&(console.error("Bad latitude or latitude value for point: ",e.features[t]),e.features.splice(t,1));s.addData(e),s.eachLayer((function(e){e.addTo(peak)})),peak.addTo(map),checkLayerCount(layerCount)}}else console.log("0 "+r.options.className+" GeoJSON features found")}))}function populateEventDates(e){for(var t=0;t<fev.data.events.length;t++)fev.data.events[t].event_id==e&&(1==fev.data.events[t].event_status_id?fev.vars.currentEventActive=!0:fev.vars.currentEventActive=!1,fev.vars.currentEventStartDate_str=null==fev.data.events[t].event_start_date?"":fev.data.events[t].event_start_date.substr(0,10),fev.vars.currentEventEndDate_str=null==fev.data.events[t].event_end_date?"":fev.data.events[t].event_end_date.substr(0,10),console.log("Selected event is "+fev.data.events[t].event_name+". START date is "+fev.vars.currentEventStartDate_str+" and END date is "+fev.vars.currentEventEndDate_str+". Event is active = "+fev.vars.currentEventActive))}function checkLayerCount(e){e==fev.layerList.length&&markerCoords.length>0&&map.fitBounds(markerCoords)}function filterMapData(e,t){$(".esconder").hide(),$(".labelSpan").empty(),layerCount=0,markerCoords=[];var a;if(a=e,null!=e&&null!=e){var r="";if(null!==$("#stateSelect").val()){if(r=$("#stateSelect").val().toString(),$("#stateSelect").select2("data").length>0)for(var s=0;s<$("#stateSelect").select2("data").length;s++)$("#stateDisplay").append('<span class="label label-default">'+$("#stateSelect").select2("data")[s].text+"</span>");$("#locationGroupDiv").show(),$("#stateDisplay_li").show()}var n="";if(null!==$("#countySelect").val()){if(n=$("#countySelect").val().toString(),$("#countySelect").select2("data").length>0)for(s=0;s<$("#countySelect").select2("data").length;s++)$("#countyDisplay").append('<span class="label label-default">'+$("#countySelect").select2("data")[s].text+"</span>");$("#locationGroupDiv").show(),$("#countyDisplay_li").show()}null===$("#sensorTypeSelect").val()&&null===$("#sensorStatusSelect").val()&&null===$("#collectionConditionSelect").val()&&null===$("#deployTypeSelect").val()||$("#sensorsGroupDiv").show();var o="";if(null!==$("#sensorTypeSelect").val()){if(o=$("#sensorTypeSelect").val().toString(),$("#sensorTypeSelect").select2("data").length>0)for(s=0;s<$("#sensorTypeSelect").select2("data").length;s++)$("#sensorTypeDisplay").append('<span class="label label-default">'+$("#sensorTypeSelect").select2("data")[s].text+"</span>");$("#sensorTypeDisplay_li").show()}var i="";if(null!==$("#sensorStatusSelect").val()){if(i=$("#sensorStatusSelect").val().toString(),$("#sensorStatusSelect").select2("data").length>0)for(s=0;s<$("#sensorStatusSelect").select2("data").length;s++)$("#sensorStatusDisplay").append('<span class="label label-default">'+$("#sensorStatusSelect").select2("data")[s].text+"</span>");$("#sensorStatusDisplay_li").show()}var l="";if(null!==$("#collectionConditionSelect").val()){if(l=$("#collectionConditionSelect").val().toString(),$("#collectionConditionSelect").select2("data").length>0)for(s=0;s<$("#collectionConditionSelect").select2("data").length;s++)$("#collectConditionDisplay").append('<span class="label label-default">'+$("#collectionConditionSelect").select2("data")[s].text+"</span>");$("#collectConditionDisplay_li").show()}var p="";if(null!==$("#deployTypeSelect").val()){if(p=$("#deployTypeSelect").val().toString(),$("#deployTypeSelect").select2("data").length>0)for(s=0;s<$("#deployTypeSelect").select2("data").length;s++)$("#deployTypeDisplay").append('<span class="label label-default">'+$("#deployTypeSelect").select2("data")[s].text+"</span>");$("#deployTypeDisplay_li").show()}fev.queryStrings.sensorsQueryString="?Event="+a+"&States="+r+"&County="+n+"&SensorType="+o+"&CurrentStatus="+i+"&CollectionCondition="+l+"&DeploymentType="+p,fev.urls.csvSensorsQueryURL=fev.urls.csvSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.jsonSensorsQueryURL=fev.urls.jsonSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.xmlSensorsQueryURL=fev.urls.xmlSensorsURLRoot+fev.queryStrings.sensorsQueryString,$("#sensorDownloadButtonCSV").attr("href",fev.urls.csvSensorsQueryURL),$("#sensorDownloadButtonJSON").attr("href",fev.urls.jsonSensorsQueryURL),$("#sensorDownloadButtonXML").attr("href",fev.urls.xmlSensorsQueryURL),(null!==$("#hwmTypeSelect").val()||null!==$("#hwmQualitySelect").val()||$("#coastal")[0].checked||$("#riverine")[0].checked||$("#surveyCompleteYes")[0].checked||$("#surveyCompleteNo")[0].checked||$("#stillWaterYes")[0].checked||$("#stillWaterNo")[0].checked)&&$("#hwmGroupDiv").show();var d="";if(null!==$("#hwmTypeSelect").val()){if(d=$("#hwmTypeSelect").val().toString(),$("#hwmTypeSelect").select2("data").length>0)for(s=0;s<$("#hwmTypeSelect").select2("data").length;s++)$("#hwmTypeDisplay").append('<span class="label label-default">'+$("#hwmTypeSelect").select2("data")[s].text+"</span>");$("#hwmTypeDisplay_li").show()}var c="";if(null!==$("#hwmQualitySelect").val()){if(c=$("#hwmQualitySelect").val().toString(),$("#hwmQualitySelect").select2("data").length>0)for(s=0;s<$("#hwmQualitySelect").select2("data").length;s++)$("#hwmQualityDisplay").append('<span class="label label-default">'+$("#hwmQualitySelect").select2("data")[s].text+"</span>");$("#hwmQualityDisplay_li").show()}var u=[];$("#coastal")[0].checked&&!$("#riverine")[0].checked&&(u.push("Coastal"),$("#hwmEnvDisplay_li").show(),$("#hwmEnvDisplay").html('<span class="label label-default">Coastal</span>')),$("#riverine")[0].checked&&!$("#coastal")[0].checked&&(u.push("Riverine"),$("#hwmEnvDisplay_li").show(),$("#hwmEnvDisplay").html('<span class="label label-default">Riverine</span>'));var g=u.toString(),v=[];$("#surveyCompleteYes")[0].checked&&!$("#surveyCompleteNo")[0].checked&&(v.push("true"),$("#hwmSurveyCompDisplay_li").show(),$("#hwmSurveyCompDisplay").html('<span class="label label-default">True</span>')),$("#surveyCompleteNo")[0].checked&&!$("#surveyCompleteYes")[0].checked&&(v.push("false"),$("#hwmSurveyCompDisplay_li").show(),$("#hwmSurveyCompDisplay").html('<span class="label label-default">False</span>'));var m=v.toString(),f=[];$("#stillWaterYes")[0].checked&&!$("#stillWaterNo")[0].checked&&(f.push("true"),$("#hwmStillWaterDisplay_li").show(),$("#hwmStillWaterDisplay").html('<span class="label label-default">True</span>')),$("#stillWaterNo")[0].checked&&!$("#stillWaterYes")[0].checked&&(f.push("false"),$("#hwmStillWaterDisplay_li").show(),$("#hwmStillWaterDisplay").html('<span class="label label-default">False</span>'));var h,y,S=f.toString();fev.queryStrings.hwmsQueryString="?Event="+a+"&States="+r+"&County="+n+"&HWMType="+d+"&HWMQuality="+c+"&HWMEnvironment="+g+"&SurveyComplete="+m+"&StillWater="+S,fev.urls.csvHWMsQueryURL=fev.urls.csvHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.jsonHWMsQueryURL=fev.urls.jsonHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.xmlHWMsQueryURL=fev.urls.xmlHWMsURLRoot+fev.queryStrings.hwmsQueryString,$("#hwmDownloadButtonCSV").attr("href",fev.urls.csvHWMsQueryURL),$("#hwmDownloadButtonJSON").attr("href",fev.urls.jsonHWMsQueryURL),$("#hwmDownloadButtonXML").attr("href",fev.urls.xmlHWMsQueryURL),""===$("#peakStartDate")[0].value&&""===$("#peakEndDate")[0].value||$("#peaksGroupDiv").show(),""!==$("#peakStartDate")[0].value&&($("#peakStartDisplay_li").show(),h=$("#peakStartDate")[0].value,$("#peakStartDisplay").html(moment(h).format("D MMM YYYY"))),""!==$("#peakEndDate")[0].value&&($("#peakEndDisplay_li").show(),y=$("#peakEndDate")[0].value,$("#peakEndDisplay").html(moment(y).format("D MMM YYYY"))),fev.queryStrings.peaksQueryString="?Event="+a+"&States="+r+"&County="+n+"&StartDate="+h+"&EndDate="+y,fev.urls.csvPeaksQueryURL=fev.urls.csvPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.jsonPeaksQueryURL=fev.urls.jsonPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.xmlPeaksQueryURL=fev.urls.xmlPeaksURLRoot+fev.queryStrings.peaksQueryString,$("#peaksDownloadButtonCSV").attr("href",fev.urls.csvPeaksQueryURL),$("#peaksDownloadButtonJSON").attr("href",fev.urls.jsonPeaksQueryURL),$("#peaksDownloadButtonXML").attr("href",fev.urls.xmlPeaksQueryURL),$.each(fev.layerList,(function(e,t){"sensor"==t.Type&&displaySensorGeoJSON(t.ID,t.Name,fev.urls[t.ID+"GeoJSONViewURL"]+fev.queryStrings.sensorsQueryString,window[t.ID+"MarkerIcon"]),"hwm"==t.ID&&displayHWMGeoJSON(t.ID,t.Name,fev.urls.hwmFilteredGeoJSONViewURL+fev.queryStrings.hwmsQueryString,hwmMarkerIcon),"peak"==t.ID&&displayPeaksGeoJSON(t.ID,t.Name,fev.urls.peaksFilteredGeoJSONViewURL+fev.queryStrings.peaksQueryString,peakMarkerIcon)}))}else alert("Please select an event to proceed")}function queryNWISRainGages(e){var t={},a="https://waterservices.usgs.gov/nwis/site/?format=mapper&bBox="+e+"&parameterCd=00045,46529,72192&siteType=OC,OC-CO,ES,LK,ST,ST-CA,ST-DCH,ST-TS,AT,WE,SP&siteStatus=active";console.log(a),$.ajax({url:a,dataType:"xml",data:t,success:function(e){$(e).find("site").each((function(){var e=$(this).attr("sno"),a=$(this).attr("sna"),r=$(this).attr("lat"),s=$(this).attr("lng");t[e]=L.marker([r,s],{icon:nwisRainMarkerIcon}),t[e].data={siteName:a,siteCode:e},t[e].data.parameters={},USGSRainGages.addLayer(t[e]),$("#nwisLoadingAlert").fadeOut(2e3)}))},error:function(e){$("#nwisLoadingAlert").fadeOut(2e3)}})}function queryNWISrtGages(e){var t={},a="https://waterservices.usgs.gov/nwis/site/?format=mapper&bBox="+e+"&parameterCd=00065,62619,62620,63160,72214&siteType=OC,OC-CO,ES,LK,ST,ST-CA,ST-DCH,ST-TS&siteStatus=active";$.ajax({url:a,dataType:"xml",success:function(e){$(e).find("site").each((function(){var e=$(this).attr("sno"),a=$(this).attr("sna"),r=$(this).attr("lat"),s=$(this).attr("lng");t[e]=L.marker([r,s],{icon:nwisMarkerIcon}),t[e].data={siteName:a,siteCode:e},t[e].data.parameters={},USGSrtGages.addLayer(t[e]),$("#nwisLoadingAlert").fadeOut(2e3)}))},error:function(e){$("#nwisLoadingAlert").fadeOut(2e3)}})}function queryNWISgraphRDG(e){var t,a='<table class="table table-hover table-striped table-condensed"><caption class="popup-title">Rapid Deployment Gage | '+fev.vars.currentEventName+'</caption><tr><td><strong>STN Site Number: </strong></td><td><span id="siteName">'+e.layer.feature.properties.site_no+'</span></td></tr><tr><td><strong>Status: </strong></td><td><span id="status">'+e.layer.feature.properties.status+'</span></td></tr><tr><td><strong>City: </strong></td><td><span id="city">'+(""==e.layer.feature.properties.city||null==e.layer.feature.properties.city||null==e.layer.feature.properties.city?"<i>No city recorded</i>":e.layer.feature.properties.city)+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="county">'+e.layer.feature.properties.county+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="state">'+e.layer.feature.properties.state+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.layer.feature.properties.latitude_dd.toFixed(4)+", "+e.layer.feature.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>STN data page: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+sensorPageURLRoot+e.layer.feature.properties.site_id+"&Sensor="+e.layer.feature.properties.instrument_id+'>Sensor data page</a></b></span></td></tr></table><div id="RDGgraphContainer" style="width:100%; height:250px;display:none;"></div><div id="RDGdataLink" style="width:100%;display:none;"><b><span class="rdg-nwis-info" style="color:red;"> - Provisional Data Subject to Revision -</span><br><span class="rdg-nwis-info">Additional parameters available at NWISWeb</span><br><a class="nwis-link" id="rdgNWISLink" target="_blank" href="https://usgs.gov"></a></b></div><div id="noDataMessage" style="width:100%;display:none;"><b><span>No NWIS Data Available for Graph</span></b></div>';e.layer.bindPopup(a).openPopup(),$.getJSON(stnServicesURL+"/Sites/"+e.layer.feature.properties.site_id+".json",(function(e){if(e.usgs_sid.length>=8&&e.usgs_sid.length<=15){t=e.usgs_sid;var a="";if(""==fev.vars.currentEventEndDate_str&&(fev.vars.currentEventEndDate_str=moment().format("YYYY-MM-DD"),console.log("Selected event is active, so end date is today, "+fev.vars.currentEventEndDate_str)),""==fev.vars.currentEventStartDate_str||""==fev.vars.currentEventEndDate_str)$("#noDataMessage").show();else{a="&startDT="+fev.vars.currentEventStartDate_str+"&endDT="+fev.vars.currentEventEndDate_str;var r="https://waterdata.usgs.gov/nwis/uv?site_no="+t+"&begin_date="+fev.vars.currentEventStartDate_str+"&end_date="+fev.vars.currentEventEndDate_str;$("#rdgNWISLink").prop("href",r),$("#rdgNWISLink").html("Site "+t+' on NWISWeb <i class="fa fa-external-link" aria-hidden="true"></i>'),$.getJSON("https://nwis.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+t+"&parameterCd=62620,00065,00067"+a,(function(e){null==e.data?(console.log("No NWIS RDG data available for this time period"),$("#noDataMessage").show()):($("#RDGdataLink").show(),$("#RDGgraphContainer").show(),Highcharts.setOptions({global:{useUTC:!1}}),$("#RDGgraphContainer").highcharts({chart:{type:"line"},title:{text:"RDG water level, NWIS site "+t,align:"left",style:{color:"rgba(0,0,0,0.6)",fontSize:"small",fontWeight:"bold",fontFamily:"Open Sans, sans-serif"}},exporting:{filename:"FEV_RDG_NWISSite"+t},credits:{enabled:!0,text:"USGS NWIS",href:"https://waterdata.usgs.gov/nwis"},xAxis:{type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%m/%d/%y",this.value)},align:"center"}},yAxis:{title:{text:"Gage Height, feet"}},series:[{showInLegend:!1,data:e.data[0].time_series_data,tooltip:{pointFormat:"Gage height: {point.y} feet"}}]}))}))}}else $("#noDataMessage").show()}))}function queryNWISgraph(e){var t="";""==fev.vars.currentEventEndDate_str&&(fev.vars.currentEventEndDate_str=moment().format("YYYY-MM-DD")),t=""==fev.vars.currentEventStartDate_str||""==fev.vars.currentEventEndDate_str?"&period=P7D":"&startDT="+fev.vars.currentEventStartDate_str+"&endDT="+fev.vars.currentEventEndDate_str,e.layer.bindPopup('<label class="popup-title">NWIS Site '+e.layer.data.siteCode+"</br>"+e.layer.data.siteName+'</span></label></br><p id="graphLoadMessage"><span><i class="fa fa-lg fa-cog fa-spin fa-fw"></i> NWIS data graph loading...</span></p><div id="graphContainer" style="width:100%; height:200px;display:none;"></div> <a class="nwis-link" target="_blank" href="https://nwis.waterdata.usgs.gov/nwis/uv?site_no='+e.layer.data.siteCode+'"><b>Site '+e.layer.data.siteCode+' on NWISWeb <i class="fa fa-external-link" aria-hidden="true"></i></b></a><div id="noDataMessage" style="width:100%;display:none;"><b><span>NWIS water level data not available to graph</span></b></div>',{minWidth:350}).openPopup(),$.getJSON("https://nwis.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+e.layer.data.siteCode+"&parameterCd=00065,62619,62620,63160,72279"+t,(function(t){null==t.data?(console.log("No NWIS data available for this time period"),$("#graphLoadMessage").hide(),$("#noDataMessage").show()):($("#graphLoadMessage").hide(),$(".popup-title").hide(),$("#graphContainer").show(),Highcharts.setOptions({global:{useUTC:!1}}),$("#graphContainer").highcharts({chart:{type:"line"},title:{text:"NWIS Site "+e.layer.data.siteCode+"<br> "+e.layer.data.siteName,align:"left",style:{color:"rgba(0,0,0,0.6)",fontSize:"small",fontWeight:"bold",fontFamily:"Open Sans, sans-serif"}},exporting:{filename:"FEV_NWIS_Site"+e.layer.data.siteCode},credits:{enabled:!1},xAxis:{type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%d %b %y",this.value)},align:"center"}},yAxis:{title:{text:"Gage Height, feet"}},series:[{showInLegend:!1,data:t.data[0].time_series_data,tooltip:{pointFormat:"Gage height: {point.y} feet"}}]}))}))}function queryNWISRaingraph(e){var t="";""==fev.vars.currentEventEndDate_str&&(fev.vars.currentEventEndDate_str=moment().format("YYYY-MM-DD")),t=""==fev.vars.currentEventStartDate_str||""==fev.vars.currentEventEndDate_str?"&period=P7D":"&startDT="+fev.vars.currentEventStartDate_str+"&endDT="+fev.vars.currentEventEndDate_str,e.layer.bindPopup('<label class="popup-title">NWIS Site '+e.layer.data.siteCode+"</br>"+e.layer.data.siteName+'</span></label></br><p id="graphLoadMessage"><span><i class="fa fa-lg fa-cog fa-spin fa-fw"></i> NWIS data graph loading...</span></p><div id="graphContainer" style="width:100%; height:200px;display:none;"></div> <a class="nwis-link" target="_blank" href="https://nwis.waterdata.usgs.gov/nwis/uv?site_no='+e.layer.data.siteCode+'"><b>Site '+e.layer.data.siteCode+' on NWISWeb <i class="fa fa-external-link" aria-hidden="true"></i></b></a><div id="noDataMessage" style="width:100%;display:none;"><b><span>NWIS water level data not available to graph</span></b></div>',{minWidth:350}).openPopup(),$.getJSON("https://nwis.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+e.layer.data.siteCode+"&parameterCd=00045,89363,46529,72192"+t,(function(t){if(null==t.data)console.log("No NWIS data available for this time period"),$("#graphLoadMessage").hide(),$("#noDataMessage").show();else{t=2==t.data.length?t.data[1].time_series_data:t.data[0].time_series_data;var a=[],r=0;t.forEach((function(e,t){r+=e[1],a.push([e[0],r])})),$("#graphLoadMessage").hide(),$(".popup-title").hide(),$("#graphContainer").show(),Highcharts.setOptions({global:{useUTC:!1}}),$("#graphContainer").highcharts({chart:{type:"line"},title:{text:"NWIS Site "+e.layer.data.siteCode+"<br> "+e.layer.data.siteName,align:"left",style:{color:"rgba(0,0,0,0.6)",fontSize:"small",fontWeight:"bold",fontFamily:"Open Sans, sans-serif"}},exporting:{filename:"FEV_NWIS_Station"+e.layer.data.siteCode},credits:{enabled:!1},xAxis:{type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%d %b %y",this.value)},align:"center"}},yAxis:{title:{text:"Precipitation total, inches"}},tooltip:{formatter:function(){return"Precipitation total: "+Highcharts.numberFormat(this.y,2,".")+" inches"}},series:[{turboThreshold:3e3,showInLegend:!1,data:a}]})}}))}function addCommas(e){for(var t=(e+="").split("."),a=t[0],r=t.length>1?"."+t[1]:"",s=/(\d+)(\d{3})/;s.test(a);)a=a.replace(s,"$1,$2");return a+r}var stnServicesURL="https://stn.wim.usgs.gov/STNServices",sensorPageURLRoot="https://stn.wim.usgs.gov/STNPublicInfo/#/SensorPage?Site=",hwmPageURLRoot="https://stn.wim.usgs.gov/STNPublicInfo/#/HWMPage?Site=",flattenedPoly,parksLayerGroup=new L.LayerGroup,parks,isWelcomeModalOpen,refuges,bufferPoly,currentParkOrRefuge="",identifiedPeaks=[],fev=fev||{data:{events:[],eventTypes:[],states:[],counties:[],sensorTypes:[],sensorStatusTypes:[],collectionConditions:[],deploymentTypes:[],hwmTypes:[],hwmQualities:[]},urls:{jsonSensorsURLRoot:stnServicesURL+"/Instruments/FilteredInstruments.json",xmlSensorsURLRoot:stnServicesURL+"/Instruments/FilteredInstruments.xml",csvSensorsURLRoot:stnServicesURL+"/Instruments/FilteredInstruments.csv",jsonHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.json",xmlHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.xml",csvHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.csv",hwmFilteredGeoJSONViewURL:stnServicesURL+"/HWMs/FilteredHWMs.geojson",hwmGeoJSONViewURL:stnServicesURL+"/hwms.geojson",xmlPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.xml",jsonPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.json",csvPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.csv",peaksFilteredGeoJSONViewURL:stnServicesURL+"/PeakSummaries/FilteredPeaks.geojson",baroGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=baro_view&",metGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=met_view&",rdgGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=rdg_view&",stormtideGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=stormtide_view&",waveheightGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=waveheight_view&"},queryStrings:{},vars:{currentEventName:"",currentEventID_str:"",currentEventStartDate_str:"",currentEventEndDate_str:"",currentBufferSelection:20,currentEventActive:!1,extentNorth:71.3888898,extentWest:-179.148611,extentEast:-66.947028,extentSouth:18.910833},layerList:[{ID:"baro",Name:"Barometric Pressure Sensor",Type:"sensor",Category:"observed"},{ID:"stormtide",Name:"Storm Tide Sensor",Type:"sensor",Category:"observed"},{ID:"met",Name:"Meteorological Sensor",Type:"sensor",Category:"observed"},{ID:"waveheight",Name:"Wave Height Sensor",Type:"sensor",Category:"observed"},{ID:"rdg",Name:"Rapid Deployment Gage",Type:"sensor",Category:"real-time"},{ID:"hwm",Name:"High Water Mark",Type:"observed",Category:"observed"},{ID:"peak",Name:"Peak Summary",Type:"interpreted",Category:"interpreted"},{ID:"int",Name:"Interest Boundaries",Type:"fws",Category:"fws"},{ID:"appr",Name:"Approved Acquisition Boundaries",Type:"fws",Category:"fws"},{ID:"tracts",Name:"Park Tracts",Type:"nps",Category:"nps"},{ID:"bounds",Name:"Park Boundaries",Type:"nps",Category:"nps"}]},map,reviewMap,markerCoords=[],oms,mapImage,baroMarkerIcon=L.icon({className:"baroMarker",iconUrl:"images/baro.png",iconAnchor:[7,10],popupAnchor:[0,2]}),metMarkerIcon=L.icon({className:"metMarker",iconUrl:"images/met.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[16,16]}),rdgMarkerIcon=L.icon({className:"rdgMarker",iconUrl:"images/rdg.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[16,16]}),stormtideMarkerIcon=L.icon({className:"stormtideMarker",iconUrl:"images/stormtide.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[16,16]}),waveheightMarkerIcon=L.icon({className:"waveheightMarker",iconUrl:"images/waveheight.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[12,12]}),hwmMarkerIcon=L.icon({className:"hwmMarker",iconUrl:"images/hwm.png",iconAnchor:[7,10],popupAnchor:[0,2]}),peakMarkerIcon=L.icon({className:"peakMarker",iconUrl:"images/peak.png",iconAnchor:[7,10],popupAnchor:[0,2]}),nwisMarkerIcon=L.icon({className:"nwisMarker",iconUrl:"images/nwis.png",iconAnchor:[7,10],popupAnchor:[0,2]}),nwisRainMarkerIcon=L.icon({className:"nwisMarker",iconUrl:"images/rainIcon.png",iconAnchor:[7,10],popupAnchor:[0,2],iconSize:[30,30]}),baro=L.layerGroup(),stormtide=L.layerGroup(),met=L.layerGroup(),waveheight=L.layerGroup(),hwm=L.layerGroup(),peak=L.layerGroup(),appr=L.layerGroup(),int=L.layerGroup(),tracts=L.layerGroup(),bounds=L.layerGroup();$.ajax({url:"https://gis.fws.gov/arcgis/rest/services/FWS_Refuge_Boundaries/MapServer/2",async:!1,dataType:"json",success:function(e){"No active advisories at this time"==e[0].label?(noAdvisories=!0,test=e,console.log(noAdvisories)):console.log("noaa layer added")}});var rdg=L.featureGroup(),USGSRainGages=L.featureGroup(),USGSrtGages=L.featureGroup(),noaaService=L.esri.dynamicMapLayer({url:"https://nowcoast.noaa.gov/arcgis/rest/services/nowcoast/wwa_meteocean_tropicalcyclones_trackintensityfcsts_time/MapServer",opacity:.5,f:"image"}),noAdvisories=!1,test;$.ajax({url:"https://nowcoast.noaa.gov/layerinfo?request=legend&format=json&service=wwa_meteocean_tropicalcyclones_trackintensityfcsts_time",async:!1,dataType:"json",success:function(e){"No active advisories at this time"==e[0].label?(noAdvisories=!0,test=e,console.log(noAdvisories)):console.log("noaa layer added")}});var tracts=L.esri.featureLayer({url:"https://services1.arcgis.com/fBc8EJBxQRMcHlei/ArcGIS/rest/services/NPS_Land_Resources_Division_Boundary_and_Tract_Data_Service/FeatureServer/1",minZoom:9,style:function(e){return"Federal Land (Fee)"===e.properties.Interest?{color:"green",weight:2}:"Federal Land (Less than Fee)"===e.properties.Interest?{color:"yellow",weight:2}:"Public"===e.properties.Interest?{color:"orange",weight:2}:"Private"===e.properties.Interest?{color:"blue",weight:2}:"Other Federal Land"===e.properties.Interest?{color:"purple",weight:2}:"Acquisition Deferred"===e.properties.Interest?{color:"pink",weight:2}:(e.properties.Interest,{color:"black",weight:2})}}),bounds=L.esri.featureLayer({url:"https://services1.arcgis.com/fBc8EJBxQRMcHlei/ArcGIS/rest/services/NPS_Land_Resources_Division_Boundary_and_Tract_Data_Service/FeatureServer/2",minZoom:9}),appr=L.esri.featureLayer({url:"https://services.arcgis.com/QVENGdaPbd4LUkLV/ArcGIS/rest/services/FWSApproved/FeatureServer/1",minZoom:9,style:function(e){return{color:"brown",weight:2}}}),int=L.esri.featureLayer({url:"https://services.arcgis.com/QVENGdaPbd4LUkLV/ArcGIS/rest/services/FWSInterest_Simplified_Authoritative/FeatureServer/1",minZoom:9,style:function(e){return"F"===e.properties.INTTYPE1||"O"===e.properties.INTTYPE1?{color:"green",weight:2}:"S"===e.properties.INTTYPE1?{color:"purple",weight:2}:"E"===e.properties.INTTYPE1?{color:"orange",weight:2}:"L"===e.properties.INTTYPE1?{color:"yellow",weight:2}:"S"===e.properties.INTTYPE1?{color:"beige",weight:2}:"P"===e.properties.INTTYPE1?{color:"blue",weight:2}:"U"===e.properties.INTTYPE1?{color:"red",weight:2}:{color:"black",weight:2}}});int.bindPopup((function(e){return L.Util.template("<p>INTTYPE1: {INTTYPE1}",e.properties)})),$(document).ready((function(){"use strict";if($("#peakDatePicker .input-daterange").datepicker({format:"yyyy-mm-dd",endDate:"today",startView:2,maxViewMode:3,todayBtn:!0,clearBtn:!0,multidate:!1,autoclose:!0,todayHighlight:!0}),$("#btnSubmitEvent").click((function(){if(null!==$("#evtSelect_welcomeModal").val()){$("#welcomeModal").modal("hide");var e=$("#evtSelect_welcomeModal").val()[0];$("#evtSelect_filterModal").val([e]).trigger("change"),$.getJSON("https://stn.wim.usgs.gov/STNServices/events/"+e+".json",{}).done((function(e){t(e.event_name,e.event_id,e.event_status_id,e.event_start_date,e.event_end_date)})).fail((function(){console.log("Request Failed. Most likely invalid event name.")})),filterMapData(e,!1)}else $(".eventSelectAlert").show()})),$("#btnSubmitFilters").on("click",(function(){if(null!==$("#evtSelect_filterModal").val()){$("#welcomeModal").modal("hide");for(var e=$("#evtSelect_filterModal").val()[0],a=0;a<fev.data.events.length;a++)fev.data.events[a].event_id==e&&t(fev.data.events[a].event_name,fev.data.events[a].event_id,fev.data.events[a].event_status_id,fev.data.events[a].event_start_date,fev.data.events[a].event_end_date);filterMapData(e,!1),$(".eventSelectAlert").hide(),$("#filtersModal").modal("hide")}else $(".eventSelectAlert").show()})),$("#print").click((function(){var e;e={pageOrientation:"landscape",pageMargins:[20,20,20,35],footer:function(e,t){return{width:50,alignment:"right",text:"Page "+e.toString()}},content:[{text:"Peak Summaries for "+currentParkOrRefuge+" with "+fev.vars.currentBufferSelection+"Kilometer Buffer",style:"subheader"},"It is of course possible to nest any other type of nodes available in pdfmake inside table cells",{style:"tableExample",table:{body:[["Column 1","Column 2","Column 3"],[{stack:["Let's try an unordered list",{ul:["item 1","item 2"]}]},["or a nested table",{table:{body:[["Col1","Col2","Col3"],["1","2","3"],["1","2","3"]]}}],{text:["Inlines can be ",{text:"styled\n",italics:!0},{text:"easily as everywhere else",fontSize:10}]}]]}}],images:{map:mapImage},styles:{header:{fontSize:15,bold:!0},bigger:{fontSize:18,bold:!0},explanation:{fontSize:9},smaller:{fontSize:10},smallest:{fontSize:8},footer:{fontSize:9},definitionsTable:{fontSize:9}},defaultStyle:{columnGap:20}},pdfMake.createPdf(e).download("report.pdf")})),window.location.hash){var e=window.location.hash.substring(1);$.getJSON("https://stn.wim.usgs.gov/STNServices/events/"+e+".json",{}).done((function(e){var a=e.event_id.toString();t(e.event_name,e.event_id,e.event_status_id,e.event_start_date,e.event_end_date),filterMapData(a,!0)})).fail((function(){console.log("Request Failed. Most likely invalid event name.")}))}else $("#welcomeModal").modal({backdrop:"static",keyboard:!1});function t(e,t,a,r,s){history.pushState(null,null,"#"+e.replace(/\s+/g,"")),fev.vars.currentEventName=e,fev.vars.currentEventID_str=t.toString(),fev.vars.currentEventActive=1==a,fev.vars.currentEventStartDate_str=null==r?"":r.substr(0,10),fev.vars.currentEventEndDate_str=null==s?"":s.substr(0,10),console.log("Selected event is "+e+". START date is "+fev.vars.currentEventStartDate_str+" and END date is "+fev.vars.currentEventEndDate_str+". Event is active = "+fev.vars.currentEventActive),function(e,t,a,r){$("#eventNameDisplay").html(e),$("#largeEventNameDisplay").html(e);var s=[t.toString()];if($("#evtSelect_filterModal").val([s]).trigger("change"),""==a&&""==r)return;""==r?$("#largeEventDateRangeDisplay").html(moment(a).format("D MMM YYYY")):$("#largeEventDateRangeDisplay").html(moment(a).format("D MMM YYYY")+" thru "+moment(r).format("D MMM YYYY"))}(e,t,fev.vars.currentEventStartDate_str,fev.vars.currentEventEndDate_str)}map=L.map("mapDiv",{maxZoom:15}).setView([39.833333,-98.583333],4);var a,r=L.esri.basemapLayer("Topographic").addTo(map);L.Icon.Default.imagePath="./images",search_api.create("search",{size:"lg",width:500,placeholder:"Search for a Park or Refuge",menu_min_char:2,menu_max_entries:50,menu_height:400,include_gnis_major:!0,include_gnis_minor:!1,include_state:!0,include_zip_code:!1,include_area_code:!1,include_usgs_sw:!1,include_usgs_gw:!1,include_usgs_sp:!1,include_usgs_at:!1,include_usgs_ot:!1,include_huc2:!1,include_huc4:!1,include_huc6:!1,include_huc8:!1,include_huc10:!1,include_huc12:!1,on_search:function(e){console.warn(e.id+": my 'on_search' callback function - a search is started"),map.closePopup()},on_update:function(e){!1!==$("#evtSelect_welcomeModal")[0].hidden&&(f.clearLayers().addData(e.getSuggestions()),f.getBounds().isValid()&&map.fitBounds(f.getBounds().pad(.4),{paddingTopLeft:[350,0]}),$(".search-api-menu-item").off("mouseenter").on("mouseenter",(function(){var e=$(this).data("properties").Lat,t=$(this).data("properties").Lon;f.eachLayer((function(a){e===a.feature.properties.Lat&&t===a.feature.properties.Lon?a.setOpacity(1).openPopup():a.setOpacity(.4).closePopup()}))})),$(".search-api-menu-item").off("mouseleave").on("mouseleave",(function(){map.closePopup(),f.eachLayer((function(e){e.setOpacity(.4)}))})))},on_result:function(e){console.warn(e.id+": my 'on_result' callback function - a menu item was selected"),map.fitBounds([[e.result.properties.LatMin,e.result.properties.LonMin],[e.result.properties.LatMax,e.result.properties.LonMax]]).openPopup($.map(Object.keys(e.result.properties),(function(t){return"<b>"+t+": </b>"+e.result.properties[t]})).join("<br/>"),[e.result.properties.Lat,e.result.properties.Lon]);var t=e.result.properties.Name;currentParkOrRefuge=t,console.log(currentParkOrRefuge);var a,r={color:"#9933ff",weight:4,opacity:.65},s={color:"#0000cc",weight:2,opacity:100},n=(t="'"+t+"'",[]);parks=L.esri.featureLayer({url:"https://services1.arcgis.com/fBc8EJBxQRMcHlei/ArcGIS/rest/services/NPS_Land_Resources_Division_Boundary_and_Tract_Data_Service/FeatureServer/2",simplifyFactor:.5,precision:4,where:"UNIT_NAME="+t,onEachFeature:function(e,t){var a="<p>"+e.properties.UNIT_NAME+"</p>";t.bindPopup(a),n=e.geometry,flattenedPoly=turf.flatten(n),console.log(flattenedPoly)},style:s}).addTo(map),parksLayerGroup.addLayer(parks),refuges=L.esri.featureLayer({url:"https://services.arcgis.com/QVENGdaPbd4LUkLV/ArcGIS/rest/services/FWSApproved/FeatureServer/1",simplifyFactor:.5,precision:4,where:"ORGNAME="+t,onEachFeature:function(e,t){var a="<p>"+e.properties.UNIT_NAME+"</p>";t.bindPopup(a),n=e.geometry,flattenedPoly=turf.flatten(n),console.log(flattenedPoly)},style:s}).addTo(map),setTimeout(()=>{var e=turf.buffer(flattenedPoly,fev.vars.currentBufferSelection,{units:"kilometers"}),t=flattenedPoly.features.length;if(a=e,t>=1){a=e.features[0];for(var s=0;s<e.features.length;s++)if(s===t-1);else{var n=s+1,o=e.features[n];a=turf.union(a,o)}}for(var s in bufferPoly=L.geoJson(a,{style:r}).addTo(map),map.fitBounds(bufferPoly.getBounds()),peak._layers){var i=[peak._layers[s]._latlng.lng,peak._layers[s]._latlng.lat];turf.booleanPointInPolygon(i,a)&&identifiedPeaks.push(peak._layers[s])}console.log(identifiedPeaks)},600),$("#geosearchModal").modal("hide")},on_failure:function(e){console.warn(e.id+": my 'on_failure' callback function - the services returned no results or timed out")},verbose:!0}),map.on("popupopen",(function(){$(".data-disclaim").click((function(e){$("#aboutModal").modal("show"),$('.nav-tabs a[href="#disclaimerTabPane"]').tab("show")}))})),map.on({overlayadd:function(e){-1!==e.name.indexOf("Stream Gage")&&(map.getZoom()<9&&USGSrtGages.clearLayers(),map.hasLayer(USGSrtGages)&&map.getZoom()>=9&&($("#nwisLoadingAlert").show(),queryNWISrtGages(map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7))))},overlayadd:function(e){-1!==e.name.indexOf("Rain Gage")&&(map.getZoom()<9&&USGSRainGages.clearLayers(),map.hasLayer(USGSRainGages)&&map.getZoom()>=9&&($("#nwisLoadingAlert").show(),queryNWISRainGages(map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7)),USGSRainGages.bringToFront()))},overlayremove:function(e){"Cities"===e.name&&alert("removed")}}),noaaService.addTo(map);var s={"<img class='legendSwatch' src='images/nwis.png'>&nbsp;Real-time Stream Gage":USGSrtGages,"<img class='legendSwatch' src='images/rainIcon.png'>&nbsp;Real-time Rain Gage":USGSRainGages},n={},o={},i={},l={},p={};noAdvisories?document.getElementById("noTrackAdvisory").innerHTML+="No Active Advisories":i={"<img class='legendSwatch' src='images/noaa.png'>&nbsp;NOAA Tropical Cyclone Forecast Track":noaaService};l={"<img class='legendSwatch' src='images/usfws.png'>&nbsp;appr":appr,"<img class='legendSwatch' src='images/usfws.png'>&nbsp;Int":int},p={"<img class='legendSwatch' src='images/nps.png'>&nbsp;tracts":tracts,"<img class='legendSwatch' src='images/nps.png'>&nbsp;bounds":bounds},$.each(fev.layerList,(function(e,t){"real-time"==t.Category&&(s["<img class='legendSwatch' src='images/"+t.ID+".png'>&nbsp;"+t.Name]=window[t.ID]),"observed"==t.Category&&(n["<img class='legendSwatch' src='images/"+t.ID+".png'>&nbsp;"+t.Name]=window[t.ID]),"interpreted"==t.Category&&(o["<img class='legendSwatch' src='images/"+t.ID+".png'></img>&nbsp;"+t.Name]=window[t.ID]),"noaa"==t.Category&&(i["<img class='legendSwatch' src='images/"+t.ID+".png'></img>&nbsp;"+t.Name]=window[t.ID]),"fws"==t.Category&&(l["<img class='legendSwatch' src='images/usfws.png'></img>&nbsp;"+t.Name]=window[t.ID]),"nps"==t.Category&&(p["<img class='legendSwatch' src='images/nps.png'></img>&nbsp;"+t.Name]=window[t.ID])}));var d=L.control.layers(null,s,{collapsed:!1});d.addTo(map),$("#realTimeToggleDiv").append(d.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var c=L.control.layers(null,n,{collapsed:!1});c.addTo(map),$("#observedToggleDiv").append(c.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var u=L.control.layers(null,o,{collapsed:!1});u.addTo(map),$("#interpretedToggleDiv").append(u.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var g=L.control.layers(null,i,{collapsed:!1});g.addTo(map),$("#noaaToggleDiv").append(g.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var v=L.control.layers(null,l,{collapsed:!1});v.addTo(map),$("#fwsToggleDiv").append(v.onAdd(map)),$(".leaflet-top.leaflet-right").hide();var m=L.control.layers(null,p,{collapsed:!1});m.addTo(map),$("#npsToggleDiv").append(m.onAdd(map)),$(".leaflet-top.leaflet-right").hide(),oms=new OverlappingMarkerSpiderfier(map,{keepSpiderfied:!0}),$("#sensorDownloadButtonCSV").attr("href",fev.urls.csvSensorsURLRoot),$("#sensorDownloadButtonJSON").attr("href",fev.urls.jsonSensorsURLRoot),$("#sensorDownloadButtonXML").attr("href",fev.urls.xmlSensorsURLRoot),$("#hwmDownloadButtonCSV").attr("href",fev.urls.csvHWMsURLRoot),$("#hwmDownloadButtonJSON").attr("href",fev.urls.jsonHWMsURLRoot),$("#hwmDownloadButtonXML").attr("href",fev.urls.xmlHWMsURLRoot),$("#peaksDownloadButtonCSV").attr("href",fev.urls.csvPeaksURLRoot),$("#peaksDownloadButtonJSON").attr("href",fev.urls.jsonPeaksURLRoot),$("#peaksDownloadButtonXML").attr("href",fev.urls.xmlPeaksURLRoot),$(".dataTypeRadio").each((function(){$(this).on("click",(function(){var e=$(this).attr("id"),t=$("#"+e+"Form");t.show(),$(".hiddenForm").not(t).hide()}))})),$(".check").on("click",(function(){$(this).find("span").toggle()})),$("#geosearchNav").click((function(){$("#geosearchModal").modal("show"),void 0!==parks&&(map.removeLayer(parks),map.removeLayer(refuges),map.removeLayer(bufferPoly))})),$("#printNav").click((function(){$("#printModal").modal("show"),document.getElementById("dataTable").innerHTML="";var e=document.getElementById("reviewMap"),t=[];for(var a in identifiedPeaks){var r="";r=0===identifiedPeaks[a].feature.properties.is_peak_stage_estimated?"no":"yes",t.push({"Site Number":identifiedPeaks[a].feature.properties.site_no,Description:identifiedPeaks[a].feature.properties.description,Networks:identifiedPeaks[a].feature.properties.networks,State:identifiedPeaks[a].feature.properties.state,County:identifiedPeaks[a].feature.properties.county,"Peak Stage":identifiedPeaks[a].feature.properties.peak_stage,"Peak Estimated":r})}console.log(t),function(){for(var e=function(e){for(var t=[],a=$("<tr/>"),r=0;r<e.length;r++){var s=e[r];for(var n in s)-1==$.inArray(n,t)&&(t.push(n),a.append($("<th/>").html(n)))}return $("#dataTable").append(a),t}(t),a=0;a<t.length;a++){for(var r=$("<tr/>"),s=0;s<e.length;s++){var n=t[a][e[s]];null==n&&(n=""),r.append($("<td/>").html(n))}$("#dataTable").append(r)}}(),setTimeout(()=>{var t,a,r,s=(t=$(".leaflet-map-pane")[0]).style.transform.split(",");void 0===s[0]&&(a=""),a=void 0===s[0].split("(")[1]?"":parseFloat(s[0].split("(")[1].replace("px","")),r=void 0===s[1]?"":parseFloat(s[1].replace("px","")),t.style.transform="",t.style.left=a+"px",t.style.top=r+"px";for(var n=$("img.leaflet-tile"),o=[],i=[],l=[],p=0;p<n.length;p++){if(""!==n[p].style.left)o.push(parseFloat(n[p].style.left.replace("px",""))),i.push(parseFloat(n[p].style.top.replace("px",""))),l[p]="left";else if(""!==n[p].style.transform){var d=n[p].style.transform.split(",");o[p]=parseFloat(d[0].split("(")[1].replace("px","")),i[p]=parseFloat(d[1].replace("px","")),n[p].style.transform="",l[p]="transform"}else o[p]=0,l[p]="neither";n[p].style.left=o[p]+"px",n[p].style.top=i[p]+"px"}var c=$(".leaflet-marker-icon"),u=[],g=[],v=[],m=[];for(p=0;p<c.length;p++){var f=c[p].style.transform.split(",");""===f[0]||u.push(parseFloat(f[0].split("(")[1].replace("px",""))),""===f[0]?(u.push(c[p].style.cssText.split(" left: ")[1].split("px")[0]),g.push(c[p].style.cssText.split("top")[1].replace("px;",""))):g.push(parseFloat(f[1].replace("px",""))),c[p].style.transform="",c[p].style.left=u[p]+"px",c[p].style.top=g[p]+"px"}var h;for(parseFloat($("#mapDiv").css("width").replace("px","")),parseFloat($("#mapDiv").css("height").replace("px","")),p=0;p<n.length;p++)"left"===l[p]?(n[p].style.left=o[p]+"px",n[p].style.top=i[p]+"px"):"transform"===l[p]?(n[p].style.left="",n[p].style.top="",n[p].style.transform="translate("+o[p]+"px, "+i[p]+"px)"):(n[p].style.left="0px",n[p].style.top="0px",n[p].style.transform="translate(0px, 0px)");for(p=0;p<c.length;p++)c[p].style.transform="translate("+u[p]+"px, "+g[p]+"px, 0)",c[p].style.marginLeft=v[p]+"px",c[p].style.marginTop=m[p]+"px";t.style.transform="translate("+a+"px,"+r+"px)",t.style.left="",t.style.top="",html2canvas(document.getElementById("mapDiv"),{useCORS:!0}).then((function(t){h=new Event("map_ready"),t.style.width="800px",t.style.height="450px",e.append(t);t[0].toDataUrl("image/png");window.dispatchEvent(h)}))},3e3),setTimeout(()=>{document.getElementById("loader").remove(),document.getElementById("loadingMessage").remove()},3001)})),$("#printModal").on("hidden.bs.modal",(function(){document.getElementById("reviewMap").innerHTML=""})),$("#aboutNav").click((function(){$("#aboutModal").modal("show")})),$("#btnChangeFilters").click((function(){$("#evtSelect_filterModal").val([fev.vars.currentEventID_str]).trigger("change"),$("#filtersModal").modal("show")})),$(".basemapBtn").on("click",(function(){var e,t=this.id.replace("btn","");switch(t){case"Streets":t="Streets";break;case"Satellite":t="Imagery";break;case"Topo":t="Topographic";break;case"Terrain":t="ShadedRelief";break;case"Gray":t="Gray";break;case"NatGeo":t="NationalGeographic"}e=t,r&&map.removeLayer(r),r=L.esri.basemapLayer(e),map.addLayer(r),a&&map.removeLayer(a),"ShadedRelief"!==e&&"Oceans"!==e&&"Gray"!==e&&"DarkGray"!==e&&"Imagery"!==e&&"Terrain"!==e||(a=L.esri.basemapLayer(e+"Labels"),map.addLayer(a))})),document.getElementById("tenKm").checked=!1,document.getElementById("twentyKm").checked=!0,document.getElementById("thirtyKm").checked=!1,$("#tenKm").click((function(){console.log("yes"),document.getElementById("twentyKm").checked=!1,document.getElementById("thirtyKm").checked=!1,fev.vars.currentBufferSelection=10})),$("#twentyKm").click((function(){console.log("yes"),document.getElementById("tenKm").checked=!1,document.getElementById("thirtyKm").checked=!1,fev.vars.currentBufferSelection=20})),$("#thirtyKm").click((function(){console.log("yes"),document.getElementById("twentyKm").checked=!1,document.getElementById("tenKm").checked=!1,fev.vars.currentBufferSelection=30}));var f=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{opacity:.4}).bindPopup('<div style="text-align:center;"><b>'+e.properties.Label+"</b><br/>"+e.properties.Category+"</div>",{autoPan:!1}).on("mouseover",(function(){this.setOpacity(1).openPopup()})).on("mouseout",(function(){this.setOpacity(.4).closePopup()})).on("click",(function(){searchObj.result=e,searchObj.val("").trigger("result")}))}}).addTo(map);function h(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}}$("#legendButtonNavBar, #legendButtonSidebar").on("click",(function(){$("#legend").toggle()})),$("#legendClose").on("click",(function(){$("#legend").hide()})),map.on("load moveend zoomend",(function(e){var t,a;($.each(USGSrtGages.getLayers(),(function(e,a){var r=a.getPopup();r&&(t=r._isOpen)})),$.each(USGSRainGages.getLayers(),(function(e,a){var r=a.getPopup();r&&(t=r._isOpen)})),map.getZoom()<9&&(USGSrtGages.clearLayers(),USGSRainGages.clearLayers(),$("#rtScaleAlert").show()),map.getZoom()>=9&&$("#rtScaleAlert").hide(),map.hasLayer(USGSrtGages)&&map.getZoom()>=9&&!t)&&($("#nwisLoadingAlert").show(),queryNWISrtGages(a=map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7)),queryNWISRainGages(a),map.hasLayer(USGSrtGages)&&map.hasLayer(USGSRainGages)&&USGSRainGages.bringToFront());map.hasLayer(USGSRainGages)&&map.getZoom()>=9&&!t&&($("#nwisLoadingAlert").show(),queryNWISRainGages(a=map.getBounds().getSouthWest().lng.toFixed(7)+","+map.getBounds().getSouthWest().lat.toFixed(7)+","+map.getBounds().getNorthEast().lng.toFixed(7)+","+map.getBounds().getNorthEast().lat.toFixed(7)),map.hasLayer(USGSRainGages)&&map.hasLayer(USGSRainGages)&&USGSRainGages.bringToFront())})),USGSrtGages.on("click",(function(e){queryNWISgraph(e)})),USGSRainGages.on("click",(function(e){queryNWISRaingraph(e)})),rdg.on("click",(function(e){queryNWISgraphRDG(e)})),map.whenReady((function(){var e=h(map.getZoom());$("#scale")[0].innerHTML=e,console.log("Initial Map scale registered as "+e,map.getZoom());var t=map.getCenter();$("#latitude").html(t.lat.toFixed(4)),$("#longitude").html(t.lng.toFixed(4))})),map.on("zoomend",(function(){var e=map.getZoom(),t=h(e);$("#scale")[0].innerHTML=t,$("#zoomLevel")[0].innerHTML=e})),map.on("mousemove",(function(e){$("#mapCenterLabel").css("display","none"),null!==e.latlng&&($("#latitude").html(e.latlng.lat.toFixed(4)),$("#longitude").html(e.latlng.lng.toFixed(4)))})),map.on("dragend",(function(){$("#mapCenterLabel").css("display","inline");var e=map.getCenter();$("#latitude").html(e.lat.toFixed(4)),$("#longitude").html(e.lng.toFixed(4))}))})),$(document).ready((function(){$("#btnClearFilters").click((function(){$(".clearable").val("").trigger("change"),$(".check").find("span").hide(),$(".check").removeClass("active"),$('.btn-group input[type="checkbox"]').prop("checked",!1)})),$("#evtTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/eventtypes.json",headers:{Accept:"*/*"},success:function(e){e.sort((function(e,t){var a=e.TYPE,r=t.TYPE;return a<r?-1:a>r?1:0}));for(var t=0;t<e.length;t++)$("#evtTypeSelect").append('<option value="'+e[t].event_type_id+'">'+e[t].type+"</option>"),fev.data.eventTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$(".evtSelect").select2({placeholder:"Select event",allowClear:!1,maximumSelectionLength:1}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/events.json",headers:{Accept:"*/*"},success:function(e){e.sort((function(e,t){var a=e.event_start_date,r=t.event_start_date;return a>r?-1:a<r?1:0}));for(var t=0;t<e.length;t++)$(".evtSelect").append('<option value="'+e[t].event_id+'">'+e[t].event_name+"</option>"),e[t].id=e[t].event_id,fev.data.events.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#stateSelect").select2({placeholder:"All States"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/Sites/States.json",headers:{Accept:"*/*"},success:function(t){t.sort((function(e,t){var a=e.state_name,r=t.state_name;return a<r?-1:a>r?1:0}));for(var a=0;a<t.length;a++)$("#stateSelect").append('<option value="'+t[a].state_abbrev+'">'+t[a].state_name+"</option>"),t[a].id=t[a],fev.data.states.push(t[a]);e()},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#countySelect").select2({placeholder:"All Counties"}),$("#countySelect").on("select2:select select2:unselect",(function(e){})),$("#sensorTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/sensortypes.json",headers:{Accept:"*/*"},success:function(e){e.sort((function(e,t){var a=e.TYPE,r=t.TYPE;return a<r?-1:a>r?1:0}));for(var t=0;t<e.length;t++)$("#sensorTypeSelect").append('<option value="'+e[t].sensor_type_id+'">'+e[t].sensor+"</option>"),fev.data.sensorTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#sensorStatusSelect").select2({placeholder:"All Statuses"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/statustypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#sensorStatusSelect").append('<option value="'+e[t].status_type_id+'">'+e[t].status+"</option>"),fev.data.sensorStatusTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#collectionConditionSelect").select2({placeholder:"All Conditions"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/InstrCollectConditions.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#collectionConditionSelect").append('<option value="'+e[t].id+'">'+e[t].condition+"</option>"),fev.data.collectionConditions.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#deployTypeSelect").select2({placeholder:"All Deploy Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/deploymenttypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#deployTypeSelect").append('<option value="'+e[t].deployment_type_id+'">'+e[t].method+"</option>"),fev.data.deploymentTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/hwmtypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmTypeSelect").append('<option value="'+e[t].hwm_type_id+'">'+e[t].hwm_type+"</option>"),e[t].id=e[t].hwm_type_id,fev.data.hwmTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmQualitySelect").select2({placeholder:"All Qualities"}),$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/hwmqualities.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmQualitySelect").append('<option value="'+e[t].hwm_quality_id+'">'+e[t].hwm_quality+"</option>"),e[t].id=e[t].hwm_quality_id,fev.data.hwmQualities.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}});var e=function(){for(var e=0;e<fev.data.states.length;e++)$.ajax({dataType:"json",type:"GET",url:"https://stn.wim.usgs.gov/STNServices/Sites/CountiesByState.json?StateAbbrev="+fev.data.states[e].state_abbrev,headers:{Accept:"*/*"},currentState:fev.data.states[e].state_abbrev,success:function(e){fev.data.counties[this.currentState]=e},error:function(e){console.log("Error retrieving counties. The error is: "+e)}})};$("#stateSelect").on("select2:select select2:unselect",(function(e){var t=$(this).val();if(!t>0||null===t)return $("#countySelect").html(""),void $("#countySelect").append("<option value=null>Please select state(s) first </option>");var a=[];for(var r in fev.data.counties)for(var s=0;s<fev.data.counties[r].length;s++){var n=fev.data.counties[r][s].county_name;t.indexOf(r)>-1&&(a=a.concat(n))}for(var r in $("#countySelect").html(""),a){var o=a[r];$("#countySelect").append('<option value="'+o+'">'+o+"</option>")}}))}));